import openai
import os

openai.api_key = os.getenv("OPEN_AI_KEY")
import os

message = """
CRISPRとは、古代からの細菌に備わっている免疫システムの1つである。
科学者たちはこれを利用して、30億文字のヒトゲノムの中から特定の配列を捜し当ててカットし、修正し、書き換えることができる技術をつくった。

CRISPRがあれば、安くて手軽なツールで、遺伝子コードの異常のある部位を書き直すことで、がんをはじめとする遺伝子疾患を精密に治療できるようになると期待される。

また、ウイルスや細菌、植物、動物、ヒトなど、大小様々な生物のDNA配列を、デザインしたり改変したりすることが可能となった。
簡便で応用性があり安価なCRISPRは、世界中の研究者たちの想像力をかき立て、科学を根本から変えるものとなった。

CRISPRの発見者として国際的に認められているのは、エマニュエル・シャルパンティエとジェニファー・ダウドナの2人だ。
2012年6月に発表した論文で、DNA配列のねらった場所を思いどおりに切断できるように細菌酵素をプログラムすることに成功した。

だが、CRISPRは2人だけの成果ではない。
何十年にもわたる基礎生物医学への投資と、幾多の科学者たちの地道な研究がもたらしたブレークスルーである。


細菌とウイルスは、微生物界における永遠のライバルだ。
両者は少なくとも10億年ものあいだ、闘いを続けてきた。

細菌は、細菌にのみ感染するウイルス(ファージ)に脅かされている。
ファージは細菌の細胞壁にくっつくと自身の遺伝物質を細菌に送り込み、宿主のタンパク質合成装置を乗っ取って、子孫を増殖させる。

細菌がファージに対抗するためにつくりだした免疫系の1つがCRISPRだ。
CRISPRは、細菌ゲノムの中の小さな領域で、過去に感染したウイルスの遺伝子コードの断片(スペーサー配列)が、同一のリピート配列として整然と保管されている。
それはあたかも、FBIの指名手配犯ファイルのようだ。

細胞がウイルスの侵入を検知すると、「CRISPRアレイ」と呼ばれる配列の領域が活性化され、ウイルス塩基配列のRNAコピーが作られ、短い断片に切断される。
この断片が「Cas」という酵素と結合することで、RNAが照合したウイルスのDNAを見つけ出し、切断、無力化する。

科学者たちは、この仕組を利用して、ウイルス由来のRNAのかわりに自身がデザインした合成ガイドRNAを、Casの中でも最もシンプルな「Cas9」に結合させることで、どの生物のどの遺伝子のどんなDNA配列でも標的にできる技術を開発した。
自然界のあらゆる生物は、A、C、T、Gという同じ4文字のアルファベットで書かれたDNAコードを使っているため、ヒトであれ、他の動植物であれ、同じ技術を応用できるのだ。

細菌のDNAにあるリピート配列の発見は、1987年に発表された大阪大学の中田篤男と石野良純の論文(在籍は当時)において報告されていた。
さらにスペインの微生物学者フランシスコ・モヒカは、塩田に生息する古細菌のDNAから謎めいたリピート配列を発見し、2001年にそれをCRISPRと名付け、2004年の論文で、CRISPRが免疫システムに関与していることを示した。

デンマークのヨーグルト会社〈ダニスコ〉社の研究者であるフィリップ・ホーヴァートとロドルフ・バランゴウは、細菌の研究の過程でCRISPR―Casシステムが細菌の獲得免疫システムであることを実験によって示した。
この実験を通じ、モヒカらの予測の正しさは証明された。
成果は、2007年に『サイエンス』に論文として掲載された。


シャルパンティエは2011年、CRISPR―Cas9と、ゲノム編集の重要なカギを握る「トランス活性型CRISPR・RNA」(tracrRNA)との関係を解き明かした論文を『ネイチャー』で発表した。
そしてCas9の構造を解明するために、ダウドナを共同研究に誘った。
2人は意気投合して、研究チームを結成した。

研究チームは、CRISPR―Cas9システムが、オーダーメイド可能で、どんなDNA配列でもほぼ例外なく、試験管内で望みどおりに切断できることを示す論文を、2012年6月に『サイエンス』に投稿した。『サイエンス』の編集者は素早く反応し、わずか12日で論文を受理して、投稿から20日後にはオンラインで掲載された。
この論文では、細菌のDNAの実験だけが示され、植物やヒトを含む動物の細胞で働くことは示されていない。

ホーヴァートとバランゴウと5年間の共同研究を行ったリトアニア人生物学者のシクスニスは、Cas9を使ってDNAをねらいどおりに切断する実験を行い、2012年3月に医学・生化学などを扱う世界屈指の学術誌『セル』に投稿した。
しかし、1週間後に論文は却下された。

そこで、他の科学誌に順に投稿して、2012年9月にようやく掲載された。
ただ、記事はすでにダウドナとシャルパンティエの論文を確認しただけの内容となっていた。

科学の論文発表レースでは、ときにこういった運に左右されることがある。
シクスニスは、2018年にダウドナとシャルパンティエとともにカブリ賞を受賞して、ようやく国際的な評価を受けた。


ヒト細胞に対してCRISPRゲノム編集が可能であることを示した論文は、2013年1月に『サイエンス』に同時に掲載されたフェン・ジャンの論文とジョージ・チャーチの論文である。

CRISPRシステムがヒト細胞に適用できるとわかったことで、新しい遺伝子治療の可能性が切り開かれた。
ゲノム編集に携わるベンチャー・キャピタルの商業的価値も高まることになった。

ノーベル賞では、ひとつの賞を受賞できるのが最大3人までであるため、賞のシーズンになると、メディアは「聖なる3人組」を探す傾向がある。
実際、ダウドナとシャルパンティエ、ジャンの3人が、各国の様々な賞を受賞することになった。

難病に対する遺伝子治療は、CRISPR以前にも試みられてきた。
しかし、コストが高く、成功率が低く、臨床試験で死者を出したこともあって、一進一退を続けていた。

そうした状況下、ゲノム編集による治療は、薬による対処療法と違って根本的な原因を一度で永続的に治すことができる点で、患者にとって大きな利点がある。
正確かつ安全性の高いCRISPRは、ゲノム編集による精密医療において究極の新兵器となり得るものであり、新たなバイオテク産業を活性化させた。

何十億ドルもの価値があるこの技術の特許をめぐり、ダウドナとシャルパンティエの2人とジャンの間で特許紛争が生じている。
CRISPR-Cas9でDNA編集が可能であることを示したのは前者だが、ヒトの生きた細胞での編集を成功させたのはジャンだからだ。

科学者たちは、それぞれ新しくバイオテク企業をたち上げた。
長引く特許紛争にかかる何百万ドルもの費用は、バイオテク企業が負担している。
そこには、特許紛争に敗れるとノーベル賞受賞の可能性が低くなるという算段もありそうだ。


CRISPRによってヒトの生殖細胞系列を編集してはならないとする考えは、科学者たちに共有された倫理であった。
適切な議論がなされぬまま、研究が不十分な段階でヒト胚による実験が行われれば、社会的な批判を招き、研究の可能性が閉ざされてしまう恐れもあった。

それでも、だれかがそういった研究に乗り出す可能性も予見されていた。
そしてその危惧は現実のものとなる。

2018年11月に香港で開かれた第2回ヒトゲノム編集国際倫理サミットの開催直前になり、中国人科学者の賀建奎(フー・ジェンクイ)が、CRISPRによる遺伝子編集が施された双子を誕生させたというニュースが報じられた。

中国では当時、HIVが公衆衛生上の大きな問題となっていた。
賀建奎が遺伝子編集を行ったのは、生まれてくる子供にHIVへの抵抗力を持たせることが目的であったとされる。

ダウドナやジャンも発表したサミットでは、プログラムを急遽変更して賀建奎の発表の枠が用意された。
多くの報道陣も集結した。

科学者たちのグローバル・コンセンサスに反する研究に対して、激しい非難が浴びせられた。
中国共産党の機関誌『人民日報』は、当初は「中国が達成した歴史的偉業」と称賛する記事を掲載したが、世界中からの批判が高まると、その記事はすぐに削除され、批判的な論調に転じた。

2019年1月、国営通信の新華社は、賀建奎が地元当局による取り調べを受け、法にしたがって厳重に罰せられると報じた。
その後、有罪判決が下された。


賀建奎の研究は、倫理的にも医学的にも問題があるものだった。
体外授精の際、精子の洗浄を行えばHIV感染のリスクを低下させられる。
そのため、遺伝子編集は医学的に満たされていないニーズに対応したものとは言えない。

双子に施した遺伝子編集では、ねらいどおりの編集に成功しなかった。
どのような影響がもたらされるかわからない、未知の遺伝子変異が生じてしまった。
そのため、双子が健康に長生きできるかも不明である。
臨床に参加した夫婦へのインフォームドコンセントが、独立した第三者ではなく、賀建奎自身によって行われた点や、実験が秘密裏に進められた点でも問題を抱えている。

香港サミットの1週間前に、賀建奎は『ネイチャー』に論文を投稿していた。
だが、論文には明らかな誤りが含まれているとされ、却下された。

賀建奎は世界中から、利己的な「愚かな科学者」というレッテルが貼られた。
しかし本当にそう言えるだろうか。
彼は名もなき研究者ではなく、国家から研究資金を惜しみなく与えられた、選ばれた科学者だった。
政府の有力者から極秘の支援を受けていたものの、見捨てられてしまったのかもしれない。

監視国家の中国で、これほどの研究を秘密裏に行えるはずがない。
実際に中国は、ゲノム編集分野でも世界のリーダーになろうとしていた。
中国ではヒト胚編集の研究が盛んに行われている。
愚かなのは、彼個人ではなく、科学界なのだ。

CRISPR技術によって、絶滅した動植物を復活させたり、マラリアを媒介する蚊を遺伝子操作によって絶滅させたり、農産物の品種改良によって食料生産量を世界人口の増加に見合うように増加させたり、遺伝子由来の疾患の治療方法を確立させたりすることが可能となるはずだ。

一方、生殖細胞系列の編集により、知能や肉体がエンハンスメントされたスーパー人種や、痛みや恐怖を感じないスーパー兵士が生み出されることも、現実的な可能性として想定される。
意図的な遺伝子改変は、遺伝子プールを汚染して人類の多様性を失わせることになるかもしれない。

CRISPRゲノム編集技術は、誕生から10年ほどしか経っていないにもかかわらず、様々な分野に変革をもたらしている。
同時に、倫理的な問題も依然立ちはだかっている。

なにが適切であるのか、科学者や医師だけでなく、様々な立場の人々が議論に参加する必要がある。
CRISPRが向かう先は、われわれ全員に委ねられているのだ。
"""
# テキストを分割するためのパラメータ
chunk_size = 2048  # 一度に処理できる最大の文字数
overlap_size = 512  # チャンク間で重複する文字数

# 分割されたテキストの各チャンクにフレーズを追加する
chunks = []
for idx, start_idx in enumerate(range(0, len(message), chunk_size-overlap_size)):
    chunk = message[start_idx:start_idx+chunk_size]
    if idx == 0:
        chunk = "以下の情報をあとでまとめたいのでいったん覚えてください。：\n\n" + chunk
    else:
        chunk = "こちらは追加の情報です。まとめたいのでいったん覚えてください。：\n\n" + chunk
    chunks.append(chunk)

# 各チャンクを個別に要約する
summaries = []
for chunk in chunks:
    print("+"*60)
    print("+ 入力")
    print(chunk)
    print("+"*60)

    response = openai.Completion.create(
        engine="text-davinci-003",
        prompt=chunk,
        temperature=0.5,
        max_tokens=256,
        top_p=1,
        frequency_penalty=0,
        presence_penalty=0
    )
    print("*"*60)
    print("* 結果")
    print("*"*60)
    print(response.choices[0].text.strip())

# すべてのチャンクの要約を組み合わせて、最終的な要約を生成する
final_summary = "日本語の要約として、これまでで伝えた情報を10個で要約して下さい。"
print("+" * 60)
print("+ 入力")
print(final_summary)
print("+" * 60)

final_response = openai.Completion.create(
    engine="text-davinci-003",
    prompt=final_summary,
    temperature=0.5,
    max_tokens=256,
    top_p=1,
    frequency_penalty=0,
    presence_penalty=0
)
final_summary = final_response.choices[0].text.strip()

print("#" * 60)
print("#" * 60)
print("#" * 60)
print(final_summary)

# すべてのチャンクの要約を組み合わせて、最終的な要約を生成する
final_summary = "続きもお願いします。"
print("+" * 60)
print("+ 入力")
print(final_summary)
print("+" * 60)

final_response = openai.Completion.create(
    engine="text-davinci-003",
    prompt=final_summary,
    temperature=0.5,
    max_tokens=256,
    top_p=1,
    frequency_penalty=0,
    presence_penalty=0
)
final_summary = final_response.choices[0].text.strip()

print("#" * 60)
print("#" * 60)
print("#" * 60)
print(final_summary)